<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>清水の森スタッフログイン</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f6f7fb; color:#222; display:flex; align-items:center; justify-content:center; height:100vh; margin:0;}
    .card { background:#fff; padding:28px; border-radius:8px; box-shadow:0 6px 22px rgba(20,30,60,0.08); width:360px; max-width:92%; }
    h1 { margin:0 0 8px 0; font-size:20px; }
    p.hint { margin:0 0 18px 0; color:#444; font-size:14px; }
    label { display:block; margin-top:12px; font-size:13px; color:#333; }
    input[type="email"], input[type="password"] { width:100%; padding:10px 12px; margin-top:6px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; }
    button { margin-top:18px; width:100%; padding:10px; border:0; background:#1e88e5; color:#fff; border-radius:6px; font-weight:600; cursor:pointer; }
    .note { margin-top:10px; font-size:12px; color:#666; text-align:center; }
    .error { margin-top:10px; color:#b00020; font-size:13px; text-align:center; display:none; }
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="login-title">
    <h1 id="login-title">清水の森 - スタッフログイン</h1>
    <p class="hint">端末管理者が発行したアカウントでログインしてください。</p>

    <form id="loginForm" onsubmit="return signIn();">
      <label for="email">メールアドレス</label>
      <input id="email" type="email" autocomplete="username" required />

      <label for="password">パスワード</label>
      <input id="password" type="password" autocomplete="current-password" required />

      <button id="signinBtn" type="submit">ログイン</button>
    </form>

    <div class="error" id="errorBox"></div>
    <div class="note">※スタッフ権限 (role='staff') を付与された端末管理者のアカウントで操作してください。</div>
  </div>

  <!-- Firebase の SDK を既に使っている場合は重複に注意してください -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    // TODO: あなたの既存 firebase 初期化設定がある場合はここに置き換えてください。
    // 例: const firebaseConfig = { apiKey: "...", authDomain: "...", projectId: "...", ... };
    // firebase.initializeApp(firebaseConfig);

    // 以下は既に初期化済みであればそのまま動きます
    const auth = firebase.auth();

    const errorBox = document.getElementById('errorBox');
    function showError(msg) {
      errorBox.textContent = msg;
      errorBox.style.display = 'block';
    }

    async function signIn() {
      errorBox.style.display = 'none';
      const email = document.getElementById('email').value.trim();
      const pw = document.getElementById('password').value;

      if (!email || !pw) {
        showError('メールアドレスとパスワードを入力してください。');
        return false;
      }

      document.getElementById('signinBtn').disabled = true;
      try {
        await auth.signInWithEmailAndPassword(email, pw);
        // ログイン成功後の処理（例: トークン更新してメインへ遷移）
        // カスタムクレームや role の確認は client 側で必要に応じて行ってください
        // 例: location.href = 'index.html';
        location.href = 'index.html';
      } catch (err) {
        console.error(err);
        showError(err.message || 'ログインに失敗しました。');
        document.getElementById('signinBtn').disabled = false;
      }
      return false; // form submit 無効化
    }
  </script>
</body>
</html>
