<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カフェ予約管理</title>
  <style>
    body {
      font-family: 'Yu Gothic', 'Meiryo', 'sans-serif';
      background: #f8f6f3;
      color: #333;
      margin: 0; padding: 0 0 50px 0; min-height: 100vh;
    }
    h1 {
      font-size: 2.2em; color: #94653b;
      background: linear-gradient(to right, #ffecd2 40%, #fcb69f 100%);
      margin: 0; padding: 32px 0 18px 0; text-align: center; font-weight: 700; box-shadow: 0 2px 8px #e5d8cd55;
    }
    form {
      display: flex; flex-wrap: wrap; gap: 14px 24px;
      background: #fffde9; border-radius: 18px;
      padding: 18px 30px 15px 18px; margin: 36px auto 22px auto;
      width: min(620px, 98vw); box-shadow: 0 2px 6px #f5e0b8b8;
    }
    label { font-size: 1.08em; margin-bottom: 2px; flex: 1 1 44%; min-width: 140px;}
    input, select { font-size: 1.12em; padding: 5px 7px; margin-left: 5px; border-radius: 7px; border: 1px solid #d3c1bc; background: #fff;}
    .table-choice {display: flex; flex-wrap: wrap; gap: 5px 10px; margin-bottom: 2px;}
    .table-checkbox {margin-right: 1px; vertical-align: middle;}
    .table-label {margin-right: 13px; font-size: 1.07em;}
    .cap-text {
      color: #815d0c;
      font-size: 0.96em;
      background: #ffd9b3;
      padding: 1.8px 7px 0.7px 7px;
      border-radius: 11px;
      margin-left: 5px;
      letter-spacing: 1px;
    }
    button {
      font-size: 1.14em; padding: 8px 22px; margin-top: 18px;
      border: none; border-radius: 10px;
      background: linear-gradient(90deg, #ffd9b3 2%, #ffb382 100%);
      color: #744d29; font-weight: bold; cursor: pointer; transition: background 0.15s;
      box-shadow: 0 1px 3px #edd2a588;
    }
    button:hover { background: linear-gradient(90deg, #ffd9b3 0%, #fd8a25 100%);}
    h2{margin-top:36px; font-size:1.7em; color: #b05c1e; text-align:center; }
    #listArea { width: min(900px, 98vw); margin: 18px auto 0 auto; background: #fffdfa; border-radius: 16px; box-shadow: 0 2px 12px #ecd4af66; padding: 18px 12px 28px 12px;}
    .date-title { font-size:1.1em; margin: 30px 2px 8px 6px; font-weight: bold; color: #564400; text-shadow: 0 1px 2px #ffeec9, 0 0 2px #fff; border-bottom: 2px dashed #e9c49f; padding-bottom: 3px;}
    .group-title { font-size:1.06em; font-weight:bold; margin: 17px 0 7px 10px; color: #b85d21;}
    table { border-collapse: separate; border-spacing: 0; width: 99%; margin-bottom: 3px; box-shadow: 0 1px 8px #f5e0b888;}
    thead th { background: #ffe9c1; font-size:1em; letter-spacing:1px;}
    tbody tr { height: 36px;}
    td { font-size: 1.05em; padding: 8px 10px 5px 10px; text-align: center; background: #fffbe6;}
    td.table-no {
      background: #f8e8cc; color: #6b4700; font-weight: bold; border-left: 4px solid #e6cb98; border-right: 1.7px solid #edcd90;
      border-radius: 11px 0 0 11px; width: 65px; letter-spacing: 2px; font-size: 1.04em;
    }
    td.cap-cell {
      background: #fdf0d7; font-size: 0.95em; color: #ad7713; font-weight: bold;
    }
    td.empty {
      background: #f8efe2; color: #aeaeae; border: 1.1px dashed #efe1ca; font-style: italic;
    }
    td.reserved {
      background: #fff0da; color: #a65c06; font-weight: bold; border: 2.5px solid #fcb869; box-shadow: 0 1px 3px #fcb86955; letter-spacing:1px;
    }
    td.phone { font-size: 0.97em; color: #346578; font-weight: 600; letter-spacing: 0.5px;}
    td.num { font-size:1.07em; font-weight:600; color:#6845ad;}
    @media (max-width: 1000px) {
      form, #listArea { width: 99vw; padding: 12px 1vw;}
      table {font-size: 0.97em;}
      .group-title, .date-title{ font-size:0.99em;}
    }
  </style>
</head>
<body>
<h1>カフェ予約登録</h1>
<form id="resForm">
  <label>
    日付:
    <input type="date" id="date" required>
  </label>
  <label>
    時間帯:
    <select id="time" required>
      <option value="">選択してください</option>
      <option value="11:00">11時～</option>
      <option value="13:00">13時～</option>
      <option value="dinner">ディナー</option>
    </select>
  </label>
  <label>
    人数:
    <input type="number" id="num" required min="1" max="10" style="width:60px;">
  </label>
  <label style="flex-basis:100%;">
    テーブル番号（複数選択可）:
    <div class="table-choice">
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T1" id="tb-T1">
        <label for="tb-T1">T1 <span class="cap-text">4人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T2" id="tb-T2">
        <label for="tb-T2">T2 <span class="cap-text">4人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T3" id="tb-T3">
        <label for="tb-T3">T3 <span class="cap-text">4人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T4" id="tb-T4">
        <label for="tb-T4">T4 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T5" id="tb-T5">
        <label for="tb-T5">T5 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T6" id="tb-T6">
        <label for="tb-T6">T6 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T7" id="tb-T7">
        <label for="tb-T7">T7 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T8" id="tb-T8">
        <label for="tb-T8">T8 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T9" id="tb-T9">
        <label for="tb-T9">T9 <span class="cap-text">2人</span></label>
      </span>
      <span class="table-label">
        <input type="checkbox" class="table-checkbox" name="tableNo" value="T10" id="tb-T10">
        <label for="tb-T10">T10 <span class="cap-text">2人</span></label>
      </span>
    </div>
  </label>
  <label>
    名前（カタカナ）:
    <input type="text" id="name" pattern="^[ァ-ヴー]+$" required placeholder="例：カトウ">
  </label>
  <label>
    電話番号:
    <input type="tel" id="tel" pattern="^[0-9\-]+$" required placeholder="例：090-1234-5678">
  </label>
  <button type="submit">予約登録</button>
</form>

<h2>予約一覧</h2>
<section id="listArea"></section>

<script>
  // テーブルキャパ定義
  const TABLE_CAPACITY = {
    "T1": 4, "T2": 4, "T3": 4,
    "T4": 2, "T5": 2, "T6": 2, "T7": 2, "T8": 2, "T9": 2, "T10": 2
  };
  const TABLES = Object.keys(TABLE_CAPACITY);

  function getReservations() {
    return JSON.parse(localStorage.getItem("reservations_v3") || "[]");
  }
  function saveReservations(list) {
    localStorage.setItem("reservations_v3", JSON.stringify(list));
  }

  function renderList() {
    const area = document.getElementById("listArea");
    area.innerHTML = "";

    const res = getReservations();
    if (res.length === 0) {
      area.innerHTML = "<div style='color:#aaa;padding:14px;'>予約はありません</div>";
      return;
    }
    // grouped[date][time][tableNo]
    const grouped = {};
    res.forEach(r => {
      r.tables.forEach(tableNo => {
        if (!grouped[r.date]) grouped[r.date] = {};
        if (!grouped[r.date][r.time]) grouped[r.date][r.time] = {};
        grouped[r.date][r.time][tableNo] = {
          name: r.name,
          tel: r.tel,
          num: r.num
        };
      });
    });
    const dates = Object.keys(grouped).sort();

    dates.forEach(date => {
      const dateTitle = document.createElement("div");
      dateTitle.className = "date-title";
      dateTitle.textContent = date;
      area.appendChild(dateTitle);

      [["11:00", "■ランチ① 11時～"], ["13:00", "■ランチ② 13時～"], ["dinner", "■ディナー"]].forEach(([timeKey, label]) => {
        const title = document.createElement("div");
        title.className = "group-title";
        title.textContent = label;
        area.appendChild(title);

        // 表
        const table = document.createElement("table");
        const thead = document.createElement("thead");
        thead.innerHTML =
          "<tr>" +
            "<th>テーブル</th>" +
            "<th>キャパ</th>" +
            "<th>人数</th>" +
            "<th>名前</th>" +
            "<th>電話番号</th>" +
          "</tr>";
        table.appendChild(thead);
        const tbody = document.createElement("tbody");

        TABLES.forEach(tNo => {
          const tr = document.createElement("tr");
          const tdNo = document.createElement("td");
          tdNo.className = "table-no";
          tdNo.textContent = tNo;
          tr.appendChild(tdNo);

          const tdCap = document.createElement("td");
          tdCap.className = "cap-cell";
          tdCap.textContent = TABLE_CAPACITY[tNo] + "人";
          tr.appendChild(tdCap);

          if (grouped[date][timeKey] && grouped[date][timeKey][tNo]) {
            const info = grouped[date][timeKey][tNo];
            const tdNum = document.createElement("td");
            tdNum.className = "num";
            tdNum.textContent = info.num;
            tr.appendChild(tdNum);
            const tdName = document.createElement("td");
            tdName.className = "reserved";
            tdName.textContent = info.name;
            tr.appendChild(tdName);
            const tdTel = document.createElement("td");
            tdTel.className = "phone";
            tdTel.textContent = info.tel;
            tr.appendChild(tdTel);
          } else {
            Array(3).fill(0).forEach((_, idx) => {
              const td = document.createElement("td");
              td.className = "empty";
              td.textContent = '';
              tr.appendChild(td);
            });
          }
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        area.appendChild(table);
      });
    });
  }

  document.getElementById("resForm").onsubmit = function(e) {
    e.preventDefault();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const num = document.getElementById("num").value.trim();
    const name = document.getElementById("name").value.trim();
    const tel = document.getElementById("tel").value.trim();

    // テーブル複数選択
    const tables = [];
    document.querySelectorAll("input[name=tableNo]:checked").forEach(cb => tables.push(cb.value));

    if (!date || !time || !num || !name || !tel) {
      alert("全ての項目を入力してください");
      return;
    }
    if (!(/^[ァ-ヴー]+$/.test(name))) {
      alert("名前はカタカナで入力してください");
      return;
    }
    if (tables.length === 0) {
      alert("テーブル番号を選択してください");
      return;
    }
    // 既予約チェック（同じ日・時間・テーブルに重複あるか）
    const reservations = getReservations();
    for (const t of tables) {
      const already = reservations.find(r =>
        r.date === date && r.time === time && r.tables.includes(t)
      );
      if (already) {
        alert(`${t} は既に予約されています`);
        return;
      }
    }
    reservations.push({ date, time, num, tables, name, tel });
    saveReservations(reservations);
    renderList();
    document.getElementById("resForm").reset();
    // チェックボックスもリセット
    document.querySelectorAll("input[name=tableNo]").forEach(cb => cb.checked = false);
  };

  renderList();
</script>
</body>
</html>
